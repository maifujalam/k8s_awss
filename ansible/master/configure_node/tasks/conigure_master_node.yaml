- name: Pre-pull kubernetes images v{{KUBERNETES_VERSION}}
  become: true
  shell: bash /home/{{USER}}/{{PROJECT_PATH}}/v{{KUBERNETES_VERSION}}/{{PACKAGE_DIRECTORY}}/5_kubernetes_images.sh

- name: Configure kubectl
  blockinfile:
    path: ~/.bashrc
    block: |
      source <(kubectl completion bash)
      alias k=kubectl
      complete -o default -F __start_kubectl k
    

- name: Configure helm
  become: true
  shell: bash /home/{{USER}}/{{PROJECT_PATH}}/v{{KUBERNETES_VERSION}}/{{PACKAGE_DIRECTORY}}/8_install_helm.sh

- name: Make /etc/hosts entry for mater node to ip {{MASTER_NODE_IP}}
  become: true
  lineinfile:
    path: /etc/hosts
    regexp: '^master='
    line: "{{MASTER_NODE_IP}} master"
    state: present

- name: Make /etc/hosts entry for worker node to ip {{WORKER_NODE_IP}}
  become: true
  lineinfile:
    path: /etc/hosts
    regexp: '^worker='
    line: "{{WORKER_NODE_IP}} master"
    state: present

- name: Reboot the system
  become: true
  reboot:
    reboot_timeout: 600  # Time to wait for the system to reboot (in seconds)
